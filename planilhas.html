<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Planilhas - Portal de Ferramentas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --info: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --text: #2b2d42;
            --text-light: #6c757d;
            --border: #dee2e6;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --gradient-success: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
            --gradient-warning: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
            --gradient-dark: linear-gradient(135deg, #212529 0%, #343a40 100%);
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .dark-mode {
            --primary: #4cc9f0;
            --secondary: #4895ef;
            --success: #4361ee;
            --warning: #f72585;
            --danger: #e63946;
            --info: #7209b7;
            --light: #343a40;
            --dark: #f8f9fa;
            --text: #e9ecef;
            --text-light: #adb5bd;
            --border: #495057;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --gradient-primary: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
            --gradient-dark: linear-gradient(135deg, #343a40 0%, #212529 100%);
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            --hover-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* Header Moderno */
        .main-header {
            background: var(--gradient-primary);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            50% { transform: translateX(-30px); }
            100% { transform: translateX(0); }
        }

        .header-content {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .header-title {
            font-size: 2.2rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title i {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.8rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .header-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
            margin-top: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Bot√µes Modernos */
        .btn-modern {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }

        .btn-modern:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.2);
        }

        .btn-modern:hover::before {
            left: 100%;
        }

        .dark-mode-toggle {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(15deg) scale(1.1);
        }

        /* Container Principal */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* Grid de Planilhas Moderno */
        .spreadsheets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .spreadsheet-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem 2rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .spreadsheet-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
        }

        .spreadsheet-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 0 0 0 80px;
            opacity: 0.1;
            transition: var(--transition);
        }

        .spreadsheet-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--hover-shadow);
        }

        .spreadsheet-card:hover::after {
            transform: scale(1.2);
        }

        .card-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
            position: relative;
            z-index: 2;
        }

        .spreadsheet-card:hover .card-icon {
            transform: scale(1.2) rotate(5deg);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text);
            position: relative;
            z-index: 2;
        }

        .card-description {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
            position: relative;
            z-index: 2;
        }

        .card-badge {
            display: inline-block;
            background: var(--gradient-primary);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        /* Cores espec√≠ficas para cada card */
        .card-geral { border-left-color: #4361ee; }
        .card-geral .card-icon { color: #4361ee; }

        .card-navio { border-left-color: #3a0ca3; }
        .card-navio .card-icon { color: #3a0ca3; }

        .card-areia { border-left-color: #4cc9f0; }
        .card-areia .card-icon { color: #4cc9f0; }

        .card-usinas { border-left-color: #7209b7; }
        .card-usinas .card-icon { color: #7209b7; }

        .card-container { border-left-color: #f72585; }
        .card-container .card-icon { color: #f72585; }

        .card-spot { border-left-color: #4895ef; }
        .card-spot .card-icon { color: #4895ef; }

        .card-programadas { border-left-color: #b5179e; }
        .card-programadas .card-icon { color: #b5179e; }

        .card-filial { border-left-color: #560bad; }
        .card-filial .card-icon { color: #560bad; }

        .card-demandas { border-left-color: #480ca8; }
        .card-demandas .card-icon { color: #480ca8; }

        .card-cs-demandas { border-left-color: #3f37c9; }
        .card-cs-demandas .card-icon { color: #3f37c9; }

        .card-divulgacao { border-left-color: #4361ee; }
        .card-divulgacao .card-icon { color: #4361ee; }

        /* Container da Planilha Moderno */
        .spreadsheet-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 2rem;
            margin-top: 2rem;
            display: none;
            overflow: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%;
            max-height: calc(100vh - 200px);
            position: relative;
        }

        .spreadsheet-container.active {
            display: block;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        /* Cabe√ßalho da Planilha Moderno */
        .spreadsheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10;
            padding: 1.5rem 0;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .spreadsheet-title {
            font-size: 2rem;
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .spreadsheet-title i {
            background: var(--gradient-primary);
            color: white;
            padding: 0.8rem;
            border-radius: 12px;
        }

        .spreadsheet-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .pdf-btn {
            background: var(--gradient-warning);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            box-shadow: 0 4px 15px rgba(247, 37, 133, 0.3);
        }

        .pdf-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.4);
        }

        .close-btn {
            background: var(--gradient-dark);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.3rem;
            cursor: pointer;
            color: white;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(33, 37, 41, 0.3);
        }

        .close-btn:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 8px 25px rgba(33, 37, 41, 0.4);
        }

        /* Tabela Moderna */
        .spreadsheet-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            min-width: 2500px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .spreadsheet-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 1.2rem;
            text-align: left;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .spreadsheet-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
            transition: var(--transition);
            color: var(--text);
            background: rgba(255, 255, 255, 0.8);
        }

        .spreadsheet-table tr:nth-child(even) td {
            background: rgba(248, 249, 250, 0.8);
        }

        .spreadsheet-table tr:hover td {
            background: rgba(67, 97, 238, 0.05);
            transform: scale(1.01);
        }

        .spreadsheet-table input, .spreadsheet-table select {
            width: 100%;
            padding: 0.7rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.85rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            color: var(--text);
        }

        .spreadsheet-table input:focus, .spreadsheet-table select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            transform: scale(1.02);
        }

        /* Bot√µes de A√ß√£o Modernos */
        .action-buttons {
            display: flex;
            gap: 1.5rem;
            margin-top: 2rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .save-btn {
            background: var(--gradient-success);
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 201, 240, 0.4);
        }

        .cancel-btn {
            background: var(--gradient-warning);
            color: white;
        }

        .cancel-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.4);
        }

        .add-row-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 1.5rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .add-row-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
        }

        /* Bot√µes de A√ß√£o nas Linhas */
        .row-actions {
            display: flex;
            gap: 0.7rem;
            justify-content: center;
            flex-wrap: nowrap;
        }

        .row-actions button {
            padding: 0.6rem 1rem;
            font-size: 0.8rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            min-width: 45px;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .row-actions .save-btn {
            background: var(--success);
            color: white;
        }

        .row-actions .edit-btn {
            background: var(--info);
            color: white;
        }

        .row-actions .cancel-btn {
            background: var(--danger);
            color: white;
        }

        .row-actions .view-btn {
            background: var(--primary);
            color: white;
        }

        .row-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Bot√µes Flutuantes Modernos */
        .floating-action-buttons {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            z-index: 1000;
        }

        .fab-main {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--gradient-primary);
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .fab-main:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(67, 97, 238, 0.6);
        }

        .fab-menu {
            position: absolute;
            bottom: 85px;
            right: 0;
            display: none;
            flex-direction: column;
            gap: 1rem;
        }

        .fab-menu.show {
            display: flex;
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .fab-item {
            background: var(--gradient-success);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
            transition: var(--transition);
            white-space: nowrap;
            transform: translateX(20px);
            opacity: 0;
            animation: fabItemSlide 0.3s forwards;
        }

        .fab-menu.show .fab-item:nth-child(1) { animation-delay: 0.1s; }
        .fab-menu.show .fab-item:nth-child(2) { animation-delay: 0.2s; }

        @keyframes fabItemSlide {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .fab-item:hover {
            transform: translateX(-5px) scale(1.05);
            background: var(--gradient-primary);
        }

        /* Filtros Modernos */
        .filters-container {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group select,
        .filter-group input {
            padding: 0.8rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text);
            transition: var(--transition);
            min-width: 180px;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            transform: translateY(-2px);
        }

        /* Footer Moderno */
        .main-footer {
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 4rem;
            background: var(--gradient-dark);
            color: white;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            position: relative;
            overflow: hidden;
        }

        .main-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.05" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .footer-logo {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
        }

        /* Notifica√ß√µes Modernas */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1.2rem 1.8rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: var(--transition);
            max-width: 400px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success { 
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.9) 0%, rgba(72, 149, 239, 0.9) 100%);
            border-left: 4px solid #4cc9f0;
        }
        .notification.error { 
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.9) 0%, rgba(229, 9, 20, 0.9) 100%);
            border-left: 4px solid #e63946;
        }
        .notification.info { 
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.9) 0%, rgba(58, 12, 163, 0.9) 100%);
            border-left: 4px solid #4361ee;
        }

        /* Loading Moderno */
        .loading {
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsividade Melhorada */
        @media (max-width: 1200px) {
            .spreadsheets-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .header-title {
                font-size: 1.8rem;
            }

            .spreadsheets-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .spreadsheet-card {
                padding: 2rem 1.5rem;
            }

            .spreadsheet-header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .spreadsheet-actions {
                justify-content: center;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .action-btn {
                justify-content: center;
            }

            .spreadsheet-container {
                padding: 1.5rem;
                margin-top: 1.5rem;
            }

            .filters-container {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .filter-group select,
            .filter-group input {
                min-width: auto;
            }

            .floating-action-buttons {
                bottom: 1.5rem;
                right: 1.5rem;
            }

            .fab-main {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
        }

        /* Modo somente leitura */
        .read-only .add-row-btn,
        .read-only .row-actions,
        .read-only .save-btn,
        .read-only .cancel-btn,
        .read-only .floating-action-buttons {
            display: none !important;
        }

        .read-only .spreadsheet-table input,
        .read-only .spreadsheet-table select {
            pointer-events: none;
            background-color: rgba(248, 249, 250, 0.9);
            border: none;
        }

        .required-field {
            border-color: var(--danger) !important;
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1) !important;
        }
    </style>
</head>
<body class="light-mode">
    <!-- Bot√£o Dark Mode -->
    <button id="darkModeToggle" class="dark-mode-toggle">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div>
                <h1 class="header-title">
                    <i class="fas fa-table"></i> Sistema de Planilhas
                </h1>
                <p class="header-subtitle">Controle completo de opera√ß√µes log√≠sticas</p>
            </div>
            <div class="header-actions">
                <a href="portal.html" class="btn-modern">
                    <i class="fas fa-home"></i> Voltar ao Portal
                </a>
            </div>
        </div>
    </header>

    <!-- Conte√∫do Principal -->
    <div class="main-container">
        <!-- Grid de Planilhas -->
        <div class="spreadsheets-grid">
            <!-- Planilha Geral -->
            <div class="spreadsheet-card card-geral" onclick="openSpreadsheet('geral')">
                <div class="card-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3 class="card-title">PLANILHA GERAL</h3>
                <p class="card-description">Controle completo de opera√ß√µes log√≠sticas</p>
                <span class="card-badge">Principal</span>
            </div>

            <!-- Planilha Navio -->
            <div class="spreadsheet-card card-navio" onclick="openSpreadsheet('navio')">
                <div class="card-icon">
                    <i class="fas fa-ship"></i>
                </div>
                <h3 class="card-title">PLANILHA NAVIO</h3>
                <p class="card-description">Opera√ß√µes mar√≠timas e portu√°rias</p>
            </div>

            <!-- Planilha Areia -->
            <div class="spreadsheet-card card-areia" onclick="openSpreadsheet('areia')">
                <div class="card-icon">
                    <i class="fas fa-mountain"></i>
                </div>
                <h3 class="card-title">PLANILHA AREIA</h3>
                <p class="card-description">Controle de materiais e minera√ß√£o</p>
            </div>

            <!-- Planilha Usinas -->
            <div class="spreadsheet-card card-usinas" onclick="openSpreadsheet('usinas')">
                <div class="card-icon">
                    <i class="fas fa-industry"></i>
                </div>
                <h3 class="card-title">PLANILHA USINAS</h3>
                <p class="card-description">Opera√ß√µes industriais e produ√ß√£o</p>
            </div>

            <!-- Planilha Container -->
            <div class="spreadsheet-card card-container" onclick="openSpreadsheet('container')">
                <div class="card-icon">
                    <i class="fas fa-box"></i>
                </div>
                <h3 class="card-title">PLANILHA CONTAINER</h3>
                <p class="card-description">Gest√£o de cont√™ineres e carga</p>
            </div>

            <!-- Planilha Spot -->
            <div class="spreadsheet-card card-spot" onclick="openSpreadsheet('spot')">
                <div class="card-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <h3 class="card-title">PLANILHA SPOT</h3>
                <p class="card-description">Opera√ß√µes spot e emergenciais</p>
            </div>

            <!-- Planilha Programadas -->
            <div class="spreadsheet-card card-programadas" onclick="openSpreadsheet('programadas')">
                <div class="card-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3 class="card-title">PLANILHA PROGRAMADAS</h3>
                <p class="card-description">Opera√ß√µes programadas e agendadas</p>
            </div>

            <!-- Planilha Filial -->
            <div class="spreadsheet-card card-filial" onclick="openSpreadsheet('filial')">
                <div class="card-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3 class="card-title">PLANILHA FILIAL</h3>
                <p class="card-description">Filtrar opera√ß√µes por filial</p>
            </div>

            <!-- Demandas de Contrata√ß√£o -->
            <div class="spreadsheet-card card-demandas" onclick="openSpreadsheet('demandas')">
                <div class="card-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 class="card-title">DEMANDAS DE CONTRATA√á√ÉO</h3>
                <p class="card-description">Controle de demandas e solicita√ß√µes</p>
            </div>

            <!-- CS Demandas -->
            <div class="spreadsheet-card card-cs-demandas" onclick="openCSDemandas()">
                <div class="card-icon">
                    <i class="fas fa-tasks"></i>
                </div>
                <h3 class="card-title">CS DEMANDAS</h3>
                <p class="card-description">Gest√£o de demandas do Customer Success</p>
                <span class="card-badge">Restrito</span>
            </div>

            <!-- Divulga√ß√£o de Fretes -->
            <div class="spreadsheet-card card-divulgacao" onclick="openDivulgacaoFretes()">
                <div class="card-icon">
                    <i class="fas fa-bullhorn"></i>
                </div>
                <h3 class="card-title">DIVULGA√á√ÉO DE FRETES</h3>
                <p class="card-description">Divulga√ß√£o de oportunidades de fretes</p>
            </div>
        </div>

        <!-- Container das Planilhas -->
        <div id="geral-spreadsheet" class="spreadsheet-container">
            <div class="spreadsheet-header">
                <h2 class="spreadsheet-title"><i class="fas fa-chart-line"></i> Planilha GERAL</h2>
                <div class="spreadsheet-actions">
                    <button class="pdf-btn" onclick="generatePDF('geral')">
                        <i class="fas fa-file-pdf"></i> Gerar PDF
                    </button>
                    <button class="close-btn" onclick="closeSpreadsheet('geral')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-container">
                <div class="filter-group">
                    <label for="filialFilter"><i class="fas fa-filter"></i> Filial</label>
                    <select id="filialFilter" onchange="filterTable('geral')">
                        <option value="">Todas as Filiais</option>
                        <option value="SP">S√£o Paulo</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="ES">Esp√≠rito Santo</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="statusFilter"><i class="fas fa-filter"></i> Status</label>
                    <select id="statusFilter" onchange="filterTable('geral')">
                        <option value="">Todos os Status</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                        <option value="Cancelado">Cancelado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchFilter"><i class="fas fa-search"></i> Buscar</label>
                    <input type="text" id="searchFilter" placeholder="Digite para buscar..." onkeyup="filterTable('geral')">
                </div>
            </div>

            <table class="spreadsheet-table" id="geral-table">
                <thead>
                    <tr>
                        <!-- Novas colunas -->
                        <th>Cliente</th>
                        <th>Data Recebimento</th>
                        <th>Origem</th>
                        <th>UF Origem</th>
                        <th>Destino</th>
                        <th>UF Destino</th>
                        <th>Km</th>
                        <th>Ve√≠culo</th>
                        <th>Necessidades</th>
                        <th>Qtd Paletes</th>
                        <th>Carregamento</th>
                        <th>Entrega</th>
                        <th>Tipo Opera√ß√£o</th>
                        <th>R$ Km Motorista</th>
                        <th>Custo Descarga</th>
                        <th>Ped√°gio</th>
                        <th>Frete Motorista M√°x</th>
                        <th>Ve√≠culo Design Data</th>
                        <th>Ve√≠culo Design Hora</th>
                        <th>Placas</th>
                        <th>Analista Enviou</th>
                        <th>GR Aprovada</th>
                        <th>Data</th>
                        <th>Hora</th>
                        <th>Analista Aprovou</th>
                        <th>OC Criada Data</th>
                        <th>OC Criada Hora</th>
                        <th>Analista Criou</th>
                        <th>Primeiro Contato</th>
                        <!-- Colunas existentes -->
                        <th>ID</th>
                        <th>Filial</th>
                        <th>Placa</th>
                        <th>Motorista</th>
                        <th>Data</th>
                        <th>Hora</th>
                        <th>Opera√ß√£o</th>
                        <th>Status</th>
                        <th>Destino</th>
                        <th>Origem</th>
                        <th>Produto</th>
                        <th>CT-e</th>
                        <th>NF</th>
                        <th>Valor</th>
                        <th>Observa√ß√µes</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados ser√£o carregados via JavaScript -->
                </tbody>
            </table>

            <button class="add-row-btn" onclick="addNewRow('geral')">
                <i class="fas fa-plus"></i> Adicionar Nova Linha
            </button>

            <div class="action-buttons">
                <button class="cancel-btn" onclick="closeSpreadsheet('geral')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="save-btn" onclick="saveChanges('geral')">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
            </div> 
        </div>

        <!-- Outras planilhas (estrutura similar) -->
        <div id="demandas-spreadsheet" class="spreadsheet-container">
            <div class="spreadsheet-header">
                <h2 class="spreadsheet-title"><i class="fas fa-file-alt"></i> DEMANDAS DE CONTRATA√á√ÉO</h2>
                <div class="spreadsheet-actions">
                    <button class="pdf-btn" onclick="generatePDF('demandas')">
                        <i class="fas fa-file-pdf"></i> Gerar PDF
                    </button>
                    <button class="close-btn" onclick="closeSpreadsheet('demandas')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <table class="spreadsheet-table" id="demandas-table">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>Data Recebimento</th>
                        <th>Origem</th>
                        <th>UF Origem</th>
                        <th>Destino</th>
                        <th>UF Destino</th>
                        <th>Km</th>
                        <th>Ve√≠culo</th>
                        <th>Necessidades</th>
                        <th>Qtd Paletes</th>
                        <th>Carregamento</th>
                        <th>Entrega</th>
                        <th>Tipo Opera√ß√£o</th>
                        <th>R$ Km Motorista</th>
                        <th>Custo Descarga</th>
                        <th>Ped√°gio</th>
                        <th>Frete Motorista M√°x</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados ser√£o carregados via JavaScript -->
                </tbody>
            </table>
            <button class="add-row-btn" onclick="addNewRow('demandas')">
                <i class="fas fa-plus"></i> Adicionar Nova Linha
            </button>
            <div class="action-buttons">
                <button class="cancel-btn" onclick="closeSpreadsheet('demandas')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="save-btn" onclick="saveChanges('demandas')">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>

    <!-- Bot√µes Flutuantes para Adicionar Coleta -->
    <div class="floating-action-buttons">
        <button class="fab-main" onclick="toggleFAB()">
            <i class="fas fa-plus"></i>
        </button>
        <div class="fab-menu">
            <button class="fab-item" onclick="addNewColeta('geral')" title="Adicionar Coleta Geral">
                <i class="fas fa-truck-loading"></i>
                <span>Coleta Geral</span>
            </button>
            <button class="fab-item" onclick="addNewColeta('demandas')" title="Adicionar Demanda">
                <i class="fas fa-file-contract"></i>
                <span>Nova Demanda</span>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <i class="fas fa-truck-moving"></i> LOG√çSTICA MODAL
            </div>
            <p>Sistema de Gest√£o de Opera√ß√µes Log√≠sticas</p>
            <p>¬© 2024 - Todos os direitos reservados</p>
        </div>
    </footer>

    <!-- Notifica√ß√£o -->
    <div id="notification" class="notification"></div>

    <script>
        // Configura√ß√µes e dados
        const SPREADSHEET_CONFIG = {
            geral: {
                columns: 45,
                name: 'Planilha Geral',
                icon: 'chart-line'
            },
            demandas: {
                columns: 17,
                name: 'Demandas de Contrata√ß√£o',
                icon: 'file-alt'
            },
            navio: {
                columns: 15,
                name: 'Planilha Navio',
                icon: 'ship'
            },
            areia: {
                columns: 15,
                name: 'Planilha Areia',
                icon: 'mountain'
            },
            usinas: {
                columns: 15,
                name: 'Planilha Usinas',
                icon: 'industry'
            },
            container: {
                columns: 15,
                name: 'Planilha Container',
                icon: 'box'
            },
            spot: {
                columns: 15,
                name: 'Planilha Spot',
                icon: 'bolt'
            },
            programadas: {
                columns: 15,
                name: 'Planilha Programadas',
                icon: 'calendar-alt'
            },
            filial: {
                columns: 15,
                name: 'Planilha Filial',
                icon: 'building'
            }
        };

        let currentSpreadsheet = '';
        let spreadsheetData = {
            geral: [],
            navio: [],
            areia: [],
            usinas: [],
            container: [],
            spot: [],
            programadas: [],
            filial: [],
            demandas: []
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìä Sistema de Planilhas inicializado');
            initializeDarkMode();
            checkUserPermissions();
        });

        // Dark Mode
        function initializeDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.body.classList.remove('light-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }

            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                document.body.classList.toggle('light-mode');
                
                const icon = this.querySelector('i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.className = 'fas fa-sun';
                    localStorage.setItem('theme', 'dark');
                } else {
                    icon.className = 'fas fa-moon';
                    localStorage.setItem('theme', 'light');
                }
            });
        }

        // Verificar permiss√µes do usu√°rio
        function checkUserPermissions() {
            try {
                // Verificar se h√° uma sess√£o ativa
                fetch('/api/auth/status', {
                    credentials: 'include'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.autenticado) {
                        // Usu√°rio autenticado - permitir edi√ß√£o
                        document.body.classList.remove('read-only');
                        console.log('‚úÖ Usu√°rio autenticado - Modo edi√ß√£o habilitado');
                        showNotification('Modo edi√ß√£o habilitado', 'success');
                    } else {
                        // Usu√°rio n√£o autenticado - modo leitura
                        document.body.classList.add('read-only');
                        showNotification('Apenas visualiza√ß√£o - Fa√ßa login para editar', 'info');
                    }
                })
                .catch(error => {
                    console.log('‚ùå Erro ao verificar autentica√ß√£o:', error);
                    // Em caso de erro, permitir edi√ß√£o (modo desenvolvimento)
                    document.body.classList.remove('read-only');
                });
            } catch (error) {
                console.log('‚ùå Erro na verifica√ß√£o de permiss√µes:', error);
                document.body.classList.remove('read-only');
            }
        }

        // Abrir planilha
        function openSpreadsheet(spreadsheetName) {
            // Fechar todas as planilhas
            document.querySelectorAll('.spreadsheet-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // Abrir a solicitada
            const spreadsheet = document.getElementById(`${spreadsheetName}-spreadsheet`);
            if (spreadsheet) {
                spreadsheet.classList.add('active');
                currentSpreadsheet = spreadsheetName;
                
                // Carregar dados
                loadSpreadsheetData(spreadsheetName);
                
                // Rolar para a planilha
                spreadsheet.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                showNotification(`${SPREADSHEET_CONFIG[spreadsheetName]?.name || spreadsheetName} aberta`, 'success');
            }
        }

        // Fechar planilha
        function closeSpreadsheet(spreadsheetName) {
            const spreadsheet = document.getElementById(`${spreadsheetName}-spreadsheet`);
            if (spreadsheet) {
                spreadsheet.classList.remove('active');
                showNotification('Planilha fechada', 'info');
            }
        }

        // Carregar dados
        function loadSpreadsheetData(spreadsheetName) {
            const tableBody = document.querySelector(`#${spreadsheetName}-table tbody`);
            if (!tableBody) return;

            tableBody.innerHTML = '';

            // Simular dados (substituir por API real)
            if (spreadsheetData[spreadsheetName].length === 0) {
                // Criar dados de exemplo
                for (let i = 0; i < 3; i++) {
                    addNewRow(spreadsheetName, true);
                }
            } else {
                // Carregar dados existentes
                spreadsheetData[spreadsheetName].forEach((row, index) => {
                    addRowToTable(spreadsheetName, row, index);
                });
            }
        }

        // Adicionar nova linha
        function addNewRow(spreadsheetName, initialLoad = false) {
            const tableBody = document.querySelector(`#${spreadsheetName}-table tbody`);
            if (!tableBody) return;

            const newRow = document.createElement('tr');
            const rowData = generateRowData(spreadsheetName);
            const rowIndex = spreadsheetData[spreadsheetName].length;

            newRow.innerHTML = generateRowHTML(spreadsheetName, rowData, rowIndex);
            tableBody.appendChild(newRow);

            if (!initialLoad) {
                spreadsheetData[spreadsheetName].push(rowData);
                showNotification('Nova linha adicionada', 'success');
            }
        }

        // Adicionar Nova Coleta
        function addNewColeta(spreadsheetName = 'geral') {
            if (document.body.classList.contains('read-only')) {
                showNotification('Voc√™ n√£o tem permiss√£o para adicionar coletas', 'error');
                return;
            }

            // Abrir a planilha geral se n√£o estiver aberta
            if (currentSpreadsheet !== spreadsheetName) {
                openSpreadsheet(spreadsheetName);
            }

            // Adicionar nova linha
            addNewRow(spreadsheetName);
            
            showNotification('Nova coleta adicionada! Preencha os dados.', 'success');
        }

        // Gerar dados da linha
        function generateRowData(spreadsheetName) {
            const baseData = {
                id: Math.floor(Math.random() * 1000) + 1,
                filial: 'SP',
                placa: `ABC${Math.floor(Math.random() * 9000) + 1000}`,
                motorista: 'Motorista Exemplo',
                data: new Date().toISOString().split('T')[0],
                hora: '08:00',
                operacao: 'Carregamento',
                status: 'Pendente',
                destino: 'Destino Exemplo',
                origem: 'Origem Exemplo',
                produto: 'Produto Exemplo',
                cte: `CTE${Math.floor(Math.random() * 10000)}`,
                nf: `NF${Math.floor(Math.random() * 10000)}`,
                valor: (Math.random() * 1000).toFixed(2),
                observacoes: 'Observa√ß√µes exemplo'
            };

            if (spreadsheetName === 'geral') {
                return {
                    ...baseData,
                    cliente: 'Cliente Exemplo',
                    dataRecebimentoDemanda: new Date().toISOString().split('T')[0],
                    origem: 'Origem Exemplo',
                    ufOrigem: 'SP',
                    destino: 'Destino Exemplo',
                    ufDestino: 'RJ',
                    km: Math.floor(Math.random() * 1000),
                    veiculo: 'Ve√≠culo Exemplo',
                    necessidades: 'Necessidades exemplo',
                    qtdPaletes: Math.floor(Math.random() * 10),
                    carregamento: new Date().toISOString().split('T')[0],
                    entrega: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                    tipoOperacao: 'Opera√ß√£o Exemplo',
                    kmMotorista: (Math.random() * 5).toFixed(2),
                    custoDescarga: (Math.random() * 100).toFixed(2),
                    pedagio: (Math.random() * 50).toFixed(2),
                    freteMotoristaMax: (Math.random() * 2000).toFixed(2),
                    veiculoDesignData: new Date().toISOString().split('T')[0],
                    veiculoDesignHora: '09:00',
                    placas: 'ABC1234',
                    analistaEnviou: 'Analista Exemplo',
                    grAprovada: 'Sim',
                    analistaAprovou: 'Analista Exemplo',
                    ocCriadaData: new Date().toISOString().split('T')[0],
                    ocCriadaHorario: '10:00',
                    analistaCriou: 'Analista Exemplo',
                    primeiroContato: 'Contato exemplo'
                };
            }

            return baseData;
        }

        // Gerar HTML da linha
        function generateRowHTML(spreadsheetName, rowData, rowIndex) {
            let html = '';

            if (spreadsheetName === 'geral') {
                // Novas colunas
                html += `
                    <td><input type="text" value="${rowData.cliente || ''}" data-field="cliente"></td>
                    <td><input type="date" value="${rowData.dataRecebimentoDemanda || ''}" data-field="dataRecebimentoDemanda"></td>
                    <td><input type="text" value="${rowData.origem || ''}" data-field="origem"></td>
                    <td><input type="text" value="${rowData.ufOrigem || ''}" data-field="ufOrigem"></td>
                    <td><input type="text" value="${rowData.destino || ''}" data-field="destino"></td>
                    <td><input type="text" value="${rowData.ufDestino || ''}" data-field="ufDestino"></td>
                    <td><input type="number" value="${rowData.km || ''}" data-field="km"></td>
                    <td><input type="text" value="${rowData.veiculo || ''}" data-field="veiculo"></td>
                    <td><input type="text" value="${rowData.necessidades || ''}" data-field="necessidades"></td>
                    <td><input type="number" value="${rowData.qtdPaletes || ''}" data-field="qtdPaletes"></td>
                    <td><input type="date" value="${rowData.carregamento || ''}" data-field="carregamento"></td>
                    <td><input type="date" value="${rowData.entrega || ''}" data-field="entrega"></td>
                    <td><input type="text" value="${rowData.tipoOperacao || ''}" data-field="tipoOperacao"></td>
                    <td><input type="number" step="0.01" value="${rowData.kmMotorista || ''}" data-field="kmMotorista"></td>
                    <td><input type="number" step="0.01" value="${rowData.custoDescarga || ''}" data-field="custoDescarga"></td>
                    <td><input type="number" step="0.01" value="${rowData.pedagio || ''}" data-field="pedagio"></td>
                    <td><input type="number" step="0.01" value="${rowData.freteMotoristaMax || ''}" data-field="freteMotoristaMax"></td>
                    <td><input type="date" value="${rowData.veiculoDesignData || ''}" data-field="veiculoDesignData"></td>
                    <td><input type="time" value="${rowData.veiculoDesignHora || ''}" data-field="veiculoDesignHora"></td>
                    <td><input type="text" value="${rowData.placas || ''}" data-field="placas"></td>
                    <td><input type="text" value="${rowData.analistaEnviou || ''}" data-field="analistaEnviou"></td>
                    <td><input type="text" value="${rowData.grAprovada || ''}" data-field="grAprovada"></td>
                    <td><input type="date" value="${rowData.data || ''}" data-field="data"></td>
                    <td><input type="time" value="${rowData.hora || ''}" data-field="hora"></td>
                    <td><input type="text" value="${rowData.analistaAprovou || ''}" data-field="analistaAprovou"></td>
                    <td><input type="date" value="${rowData.ocCriadaData || ''}" data-field="ocCriadaData"></td>
                    <td><input type="time" value="${rowData.ocCriadaHorario || ''}" data-field="ocCriadaHorario"></td>
                    <td><input type="text" value="${rowData.analistaCriou || ''}" data-field="analistaCriou"></td>
                    <td><input type="text" value="${rowData.primeiroContato || ''}" data-field="primeiroContato"></td>
                `;
            }

            // Colunas comuns
            html += `
                <td><input type="number" value="${rowData.id || ''}" data-field="id" readonly></td>
                <td>
                    <select data-field="filial">
                        <option value="SP" ${rowData.filial === 'SP' ? 'selected' : ''}>SP</option>
                        <option value="RJ" ${rowData.filial === 'RJ' ? 'selected' : ''}>RJ</option>
                        <option value="MG" ${rowData.filial === 'MG' ? 'selected' : ''}>MG</option>
                        <option value="ES" ${rowData.filial === 'ES' ? 'selected' : ''}>ES</option>
                    </select>
                </td>
                <td><input type="text" value="${rowData.placa || ''}" data-field="placa"></td>
                <td><input type="text" value="${rowData.motorista || ''}" data-field="motorista"></td>
                <td><input type="date" value="${rowData.data || ''}" data-field="data"></td>
                <td><input type="time" value="${rowData.hora || ''}" data-field="hora"></td>
                <td>
                    <select data-field="operacao">
                        <option value="Carregamento" ${rowData.operacao === 'Carregamento' ? 'selected' : ''}>Carregamento</option>
                        <option value="Descarga" ${rowData.operacao === 'Descarga' ? 'selected' : ''}>Descarga</option>
                        <option value="Entrega" ${rowData.operacao === 'Entrega' ? 'selected' : ''}>Entrega</option>
                        <option value="Outro" ${rowData.operacao === 'Outro' ? 'selected' : ''}>Outro</option>
                    </select>
                </td>
                <td>
                    <select data-field="status">
                        <option value="Pendente" ${rowData.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                        <option value="Em Andamento" ${rowData.status === 'Em Andamento' ? 'selected' : ''}>Em Andamento</option>
                        <option value="Conclu√≠do" ${rowData.status === 'Conclu√≠do' ? 'selected' : ''}>Conclu√≠do</option>
                        <option value="Cancelado" ${rowData.status === 'Cancelado' ? 'selected' : ''}>Cancelado</option>
                    </select>
                </td>
                <td><input type="text" value="${rowData.destino || ''}" data-field="destino"></td>
                <td><input type="text" value="${rowData.origem || ''}" data-field="origem"></td>
                <td><input type="text" value="${rowData.produto || ''}" data-field="produto"></td>
                <td><input type="text" value="${rowData.cte || ''}" data-field="cte"></td>
                <td><input type="text" value="${rowData.nf || ''}" data-field="nf"></td>
                <td><input type="number" step="0.01" value="${rowData.valor || ''}" data-field="valor"></td>
                <td><input type="text" value="${rowData.observacoes || ''}" data-field="observacoes"></td>
            `;

            // A√ß√µes (se n√£o for modo leitura)
            if (!document.body.classList.contains('read-only')) {
                html += `
                    <td class="row-actions">
                        <button class="save-btn" onclick="saveRow(this, ${rowIndex})" title="Salvar">
                            <i class="fas fa-save"></i>
                        </button>
                        <button class="edit-btn" onclick="editColeta(this)" title="Editar Coleta">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="cancel-btn" onclick="deleteColeta(this)" title="Excluir Coleta">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
            } else {
                html += `
                    <td class="row-actions">
                        <button class="view-btn" onclick="viewColeta(this)" title="Visualizar Coleta">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
            }

            return html;
        }

        // Adicionar linha √† tabela
        function addRowToTable(spreadsheetName, rowData, rowIndex) {
            const tableBody = document.querySelector(`#${spreadsheetName}-table tbody`);
            if (!tableBody) return;

            const newRow = document.createElement('tr');
            newRow.innerHTML = generateRowHTML(spreadsheetName, rowData, rowIndex);
            tableBody.appendChild(newRow);
        }

        // Salvar linha
        function saveRow(button, rowIndex) {
            const row = button.closest('tr');
            const inputs = row.querySelectorAll('input, select');
            const rowData = {};

            inputs.forEach(input => {
                const field = input.getAttribute('data-field');
                if (field) {
                    rowData[field] = input.value;
                }
            });

            spreadsheetData[currentSpreadsheet][rowIndex] = rowData;
            showNotification('Linha salva com sucesso!', 'success');
        }

        // Editar Coleta
        function editColeta(rowElement) {
            if (document.body.classList.contains('read-only')) {
                showNotification('Voc√™ n√£o tem permiss√£o para editar coletas', 'error');
                return;
            }

            const row = rowElement.closest('tr');
            const inputs = row.querySelectorAll('input, select');
            
            // Habilitar edi√ß√£o
            inputs.forEach(input => {
                input.removeAttribute('readonly');
                input.style.backgroundColor = '#fff';
                input.style.border = '2px solid #4361ee';
            });

            // Mostrar bot√µes de salvar/cancelar
            const actionCell = row.querySelector('.row-actions');
            if (actionCell) {
                const rowIndex = Array.from(row.parentNode.children).indexOf(row);
                actionCell.innerHTML = `
                    <button class="save-btn" onclick="saveColeta(this)">
                        <i class="fas fa-save"></i> Salvar
                    </button>
                    <button class="cancel-btn" onclick="cancelEdit(this)">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                `;
            }

            showNotification('Modo edi√ß√£o ativado para esta coleta', 'info');
        }

        // Salvar Coleta Editada
        function saveColeta(button) {
            const row = button.closest('tr');
            const rowIndex = Array.from(row.parentNode.children).indexOf(row);
            
            saveRow(button, rowIndex);
            
            // Restaurar estilo normal
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.style.backgroundColor = '';
                input.style.border = '';
            });

            // Restaurar bot√µes normais
            const actionCell = row.querySelector('.row-actions');
            if (actionCell) {
                actionCell.innerHTML = `
                    <button class="save-btn" onclick="saveRow(this, ${rowIndex})" title="Salvar">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="edit-btn" onclick="editColeta(this)" title="Editar Coleta">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="cancel-btn" onclick="deleteColeta(this)" title="Excluir Coleta">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
            }
        }

        // Cancelar Edi√ß√£o
        function cancelEdit(button) {
            const row = button.closest('tr');
            const rowIndex = Array.from(row.parentNode.children).indexOf(row);
            
            // Restaurar dados originais
            const originalData = spreadsheetData[currentSpreadsheet][rowIndex];
            const inputs = row.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                const field = input.getAttribute('data-field');
                if (field && originalData[field]) {
                    input.value = originalData[field];
                }
                input.style.backgroundColor = '';
                input.style.border = '';
            });

            // Restaurar bot√µes normais
            const actionCell = row.querySelector('.row-actions');
            if (actionCell) {
                actionCell.innerHTML = `
                    <button class="save-btn" onclick="saveRow(this, ${rowIndex})" title="Salvar">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="edit-btn" onclick="editColeta(this)" title="Editar Coleta">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="cancel-btn" onclick="deleteColeta(this)" title="Excluir Coleta">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
            }

            showNotification('Edi√ß√£o cancelada', 'info');
        }

        // Excluir Coleta
        function deleteColeta(rowElement) {
            if (document.body.classList.contains('read-only')) {
                showNotification('Voc√™ n√£o tem permiss√£o para excluir coletas', 'error');
                return;
            }

            const row = rowElement.closest('tr');
            const rowIndex = Array.from(row.parentNode.children).indexOf(row);
            
            if (confirm('Tem certeza que deseja excluir esta coleta?')) {
                spreadsheetData[currentSpreadsheet].splice(rowIndex, 1);
                row.remove();
                showNotification('Coleta exclu√≠da com sucesso!', 'success');
            }
        }

        // Deletar linha
        function deleteRow(button, rowIndex) {
            if (confirm('Tem certeza que deseja excluir esta linha?')) {
                spreadsheetData[currentSpreadsheet].splice(rowIndex, 1);
                button.closest('tr').remove();
                showNotification('Linha exclu√≠da com sucesso!', 'success');
            }
        }

        // Visualizar Coleta (modo leitura)
        function viewColeta(button) {
            const row = button.closest('tr');
            const rowData = {};
            const inputs = row.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                const field = input.getAttribute('data-field');
                if (field) {
                    rowData[field] = input.value;
                }
            });
            
            // Mostrar detalhes em um modal ou alerta
            const details = Object.entries(rowData)
                .map(([key, value]) => `${key}: ${value}`)
                .join('\n');
            
            alert(`Detalhes da Coleta:\n\n${details}`);
        }

        // Salvar altera√ß√µes
        function saveChanges(spreadsheetName) {
            // Simular salvamento (substituir por API real)
            setTimeout(() => {
                showNotification('Altera√ß√µes salvas com sucesso!', 'success');
                console.log('Dados salvos:', spreadsheetData[spreadsheetName]);
            }, 1000);
        }

        // Gerar PDF
        function generatePDF(spreadsheetName) {
            showNotification('Gerando PDF...', 'info');
            // Simular gera√ß√£o de PDF
            setTimeout(() => {
                showNotification('PDF gerado com sucesso!', 'success');
            }, 2000);
        }

        // Filtrar tabela
        function filterTable(spreadsheetName) {
            const filialFilter = document.getElementById('filialFilter')?.value || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';
            const searchFilter = document.getElementById('searchFilter')?.value.toLowerCase() || '';

            const rows = document.querySelectorAll(`#${spreadsheetName}-table tbody tr`);
            
            rows.forEach(row => {
                let showRow = true;
                const cells = row.querySelectorAll('td');
                
                // Filtrar por filial
                if (filialFilter) {
                    const filialCell = Array.from(cells).find(cell => {
                        const select = cell.querySelector('select[data-field="filial"]');
                        return select && select.value === filialFilter;
                    });
                    if (!filialCell) showRow = false;
                }
                
                // Filtrar por status
                if (statusFilter) {
                    const statusCell = Array.from(cells).find(cell => {
                        const select = cell.querySelector('select[data-field="status"]');
                        return select && select.value === statusFilter;
                    });
                    if (!statusCell) showRow = false;
                }
                
                // Buscar texto
                if (searchFilter) {
                    const rowText = row.textContent.toLowerCase();
                    if (!rowText.includes(searchFilter)) showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Alternar menu flutuante
        function toggleFAB() {
            const fabMenu = document.querySelector('.fab-menu');
            fabMenu.classList.toggle('show');
        }

        // Fechar menu flutuante ao clicar fora
        document.addEventListener('click', function(event) {
            const fabButtons = document.querySelector('.floating-action-buttons');
            const fabMenu = document.querySelector('.fab-menu');
            
            if (fabMenu.classList.contains('show') && !fabButtons.contains(event.target)) {
                fabMenu.classList.remove('show');
            }
        });

        // Fun√ß√µes espec√≠ficas
        function openCSDemandas() {
            showNotification('CS Demandas - Acesso restrito para usu√°rios autorizados', 'info');
            // Implementar l√≥gica espec√≠fica para CS Demandas
        }

        function openDivulgacaoFretes() {
            showNotification('Divulga√ß√£o de Fretes - Em desenvolvimento', 'info');
            // Implementar l√≥gica espec√≠fica para Divulga√ß√£o de Fretes
        }

        // Notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Exportar dados
        function exportToCSV(spreadsheetName) {
            const data = spreadsheetData[spreadsheetName];
            if (!data.length) {
                showNotification('Nenhum dado para exportar', 'warning');
                return;
            }

            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${spreadsheetName}-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Dados exportados para CSV', 'success');
        }
    </script>
</body>
</html>